<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./src/style.css" />
    <title>FlightVisualizer</title>
  </head>
  <body>
    <div id="aircraft_info_box" style="width: 0">
      <h1 style="display: inline">INFO BOX</h1>
      <span id="close-button"></span>
      <table>
        <tbody>
          <tr>
            <td>ICAO</td>
            <td id="icao">test</td>
          </tr>
          <tr>
            <td>CALL SIGN</td>
            <td id="call-sign">test</td>
          </tr>
          <tr>
            <td>ORIGIN COUNTRY</td>
            <td id="origin-country">test</td>
          </tr>
          <tr>
            <td>LONGITUDE</td>
            <td id="longitude">test</td>
          </tr>
          <tr>
            <td>LATITUDE</td>
            <td id="latitude">test</td>
          </tr>
          <tr>
            <td>BAROM. ALTITUDE</td>
            <td id="barom-altitude">test</td>
          </tr>
          <tr>
            <td>GEO. ALTITUDE</td>
            <td id="geo-altitude">test</td>
          </tr>
          <tr>
            <td>VERTICAL RATE</td>
            <td id="vertical-rate">test</td>
          </tr>
          <tr>
            <td>VELOCITY</td>
            <td id="velocity">test</td>
          </tr>
          <tr>
            <td>TRUE TRACK</td>
            <td id="true-track">test</td>
          </tr>
          <tr>
            <td>ON GROUND</td>
            <td id="on-ground">test</td>
          </tr>
          <tr>
            <td>SOURCE</td>
            <td id="source">test</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="filter">
      <h1>FILTER</h1>

      <ul class="filter-options">
        <li>s</li>
        <li>s</li>
        <li>s</li>
        <li>s</li>
        <li>s</li>
        <li>s</li>
        <li>s</li>
      </ul>

      <ul class="filter-list">
        <li class="filter-bar-item" style="color: white">
          <div class="cross-icon"></div>
          <label class="category-label">Category</label>
          <div class="min-max-slider" data-legendnum="2">
            <label for="min">Minimum price</label>
            <input
              id="min"
              class="min"
              name="min"
              type="range"
              step="1"
              min="0"
              max="3000"
            />
            <label for="max">Maximum price</label>
            <input
              id="max"
              class="max"
              name="max"
              type="range"
              step="1"
              min="0"
              max="3000"
            />
          </div>
        </li>

        <li class="filter-bar-item" style="color: white">
          <div class="cross-icon"></div>
          <label class="category-label" for="filter-input">Category</label>
          <div class="">
            <input
              class="filter-input"
              id="filter-input"
              name="filter-input"
              type="text"
            />
          </div>
        </li>

        <li class="filter-bar-item" style="color: white">
          <div class="cross-icon"></div>
          <label class="category-label" for="filter-input">Category</label>
          <div class="checkbox-container">
            <input class="checkbox" type="checkbox" />
          </div>
        </li>
      </ul>
    </div>

    <div id="altitude_box">
      <svg id="graph"></svg>
    </div>

    <div class="tooltip"></div>

    <div id="3d_content"></div>

    <script>
      let thumbsize = 14;

      function draw(slider, splitvalue) {
        /* set function vars */
        var min = slider.querySelector(".min");
        var max = slider.querySelector(".max");
        var lower = slider.querySelector(".lower");
        var upper = slider.querySelector(".upper");
        var legend = slider.querySelector(".legend");
        var thumbsize = parseInt(slider.getAttribute("data-thumbsize"));
        var rangewidth = parseInt(slider.getAttribute("data-rangewidth"));
        var rangemin = parseInt(slider.getAttribute("data-rangemin"));
        var rangemax = parseInt(slider.getAttribute("data-rangemax"));

        /* set min and max attributes */
        min.setAttribute("max", splitvalue);
        max.setAttribute("min", splitvalue);

        /* set css */
        min.style.width =
          parseInt(
            thumbsize +
              ((splitvalue - rangemin) / (rangemax - rangemin)) *
                (rangewidth - 2 * thumbsize)
          ) + "px";
        max.style.width =
          parseInt(
            thumbsize +
              ((rangemax - splitvalue) / (rangemax - rangemin)) *
                (rangewidth - 2 * thumbsize)
          ) + "px";
        min.style.left = "0px";
        max.style.left = parseInt(min.style.width) + "px";
        min.style.top = lower.offsetHeight + "px";
        max.style.top = lower.offsetHeight + "px";
        legend.style.marginTop = min.offsetHeight + "px";
        slider.style.height =
          lower.offsetHeight + min.offsetHeight + legend.offsetHeight + "px";

        /* correct for 1 off at the end */
        if (max.value > rangemax - 1) max.setAttribute("data-value", rangemax);

        /* write value and labels */
        max.value = max.getAttribute("data-value");
        min.value = min.getAttribute("data-value");
        lower.innerHTML = min.getAttribute("data-value");
        upper.innerHTML = max.getAttribute("data-value");
      }

      function init(slider) {
        /* set function vars */
        var min = slider.querySelector(".min");
        var max = slider.querySelector(".max");
        var rangemin = parseInt(min.getAttribute("min"));
        var rangemax = parseInt(max.getAttribute("max"));
        var avgvalue = (rangemin + rangemax) / 2;
        var legendnum = slider.getAttribute("data-legendnum");

        /* set data-values */
        min.setAttribute("data-value", rangemin);
        max.setAttribute("data-value", rangemax);

        /* set data vars */
        slider.setAttribute("data-rangemin", rangemin);
        slider.setAttribute("data-rangemax", rangemax);
        slider.setAttribute("data-thumbsize", thumbsize);
        slider.setAttribute("data-rangewidth", slider.offsetWidth);

        /* write labels */
        var lower = document.createElement("span");
        var upper = document.createElement("span");
        lower.classList.add("lower", "value");
        upper.classList.add("upper", "value");
        lower.appendChild(document.createTextNode(rangemin));
        upper.appendChild(document.createTextNode(rangemax));
        slider.insertBefore(lower, min.previousElementSibling);
        slider.insertBefore(upper, min.previousElementSibling);

        /* write legend */
        var legend = document.createElement("div");
        legend.classList.add("legend");
        var legendvalues = [];
        for (var i = 0; i < legendnum; i++) {
          legendvalues[i] = document.createElement("div");

          var val = Math.round(
            rangemin + (i / (legendnum - 1)) * (rangemax - rangemin)
          );
          legendvalues[i].appendChild(document.createTextNode(val));
          legend.appendChild(legendvalues[i]);
        }
        slider.appendChild(legend);

        /* draw */
        draw(slider, avgvalue);

        /* events */
        min.addEventListener("input", function () {
          update(min);
        });
        max.addEventListener("input", function () {
          update(max);
        });
      }

      function update(el) {
        /* set function vars */
        var slider = el.parentElement;
        var min = slider.querySelector("#min");
        var max = slider.querySelector("#max");
        var minvalue = Math.floor(min.value);
        var maxvalue = Math.floor(max.value);

        /* set inactive values before draw */
        min.setAttribute("data-value", minvalue);
        max.setAttribute("data-value", maxvalue);

        var avgvalue = (minvalue + maxvalue) / 2;

        /* draw */
        draw(slider, avgvalue);
      }

      var sliders = document.querySelectorAll(".min-max-slider");
      sliders.forEach(function (slider) {
        init(slider);
      });
    </script>

    <script type="module" src="./src/main.js"></script>
    <script type="module" src="./src/features/aircraftInfoBox.js"></script>
  </body>
</html>
